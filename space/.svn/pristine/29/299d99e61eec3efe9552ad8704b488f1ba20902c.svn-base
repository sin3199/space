<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bigdataB.space.mapper.adminMapper">
	<insert id="insertCate" parameterType="spaceTypeDTO">
		insert into space_type values(seq_space_type.nextval, #{cate_nm}, #{cate_img}, 0)
	</insert>

	<select id="listCate" parameterType="java.util.Map" resultType="spaceTypeDTO">
		select *
			from space_type
				order by cate_nm ${sort}
	</select>
	<select id="searchCate" parameterType="java.util.Map" resultType="spaceTypeDTO">
		select *
			from space_type where ${select} like '%'|| #{search} ||'%'
				order by cate_nm ${sort}
	</select>
	
	
		
	
	<select id="listHost" parameterType="java.util.Map" resultType="hostListDTO">
		select m.member_no, m.member_nm, m.member_email, m.member_reg_dt, m.member_pno, s.space_no,
				nvl(s.space_nm, ' ') AS space_nm, nvl(REGEXP_REPLACE(s.space_comnum, '(.{3})(.+)(.{5})', '\1-\2-\3'), ' ') as space_comnum
			from member m left outer join space s on m.member_no = s.member_no where m.member_grade = 1
			order by ${column} ${sort}
	</select>
	<select id="searchHost" parameterType="java.util.Map" resultType="hostListDTO">
		select m.member_no, m.member_nm, m.member_email, m.member_reg_dt, m.member_pno, s.space_no,
				nvl(s.space_nm, ' ') AS space_nm, nvl(REGEXP_REPLACE(s.space_comnum, '(.{3})(.+)(.{5})', '\1-\2-\3'), ' ') as space_comnum
			from member m left outer join space s on m.member_no = s.member_no where m.member_grade = 1 and ${select} like '%'||#{search}||'%'
			order by ${column} ${sort}
	</select>

	
	
	<select id="listGuest" parameterType="java.util.Map" resultType="memberDTO">
		select member_no, member_email, member_nm, member_pno, member_reg_dt
		 from member where member_grade = 0
			order by ${column} ${sort} 
	</select>
	<select id="searchGuest" parameterType="java.util.Map" resultType="memberDTO">
		select member_no, member_email, member_nm, member_pno, member_reg_dt
		 from member where member_grade = 0 and ${select} like '%'||#{search}||'%'
			order by ${column} ${sort} 
	</select>
	
	
	
	
	<select id="listSpaceRoom" parameterType="java.util.Map" resultType="roomListDTO">
		select m.member_no, m.member_nm, st.cate_nm, sr.room_nm, to_char(sr.room_price,'FM999,999,999') as room_price, sr.room_fit, sr.room_desc, sr.room_img1, to_char(sr.room_time_s, '""HH24"시 "MI"분"') as room_time_s, to_char(sr.room_time_e , '""YYYY"년 "MM"월 "DD"일"') as room_time_e 
		from space_room sr, space s, space_type st, member m 
		where sr.space_no = s.space_no and m.member_no = s.member_no and st.cate_no = s.cate_no
		order by ${column} ${sort}
	</select>
	
	<select id="searchRoom" parameterType="java.util.Map" resultType="roomListDTO">
		select m.member_no, m.member_nm, st.cate_nm, sr.room_nm, to_char(sr.room_price,'FM999,999,999') as room_price, 
		sr.room_fit, sr.room_desc, sr.room_img1, to_char(sr.room_time_s, '""HH24"시 "MI"분"') as room_time_s, to_char(sr.room_time_e , '""YYYY"년 "MM"월 "DD"일"') as room_time_e 
			from space_room sr, space s, space_type st, member m 
				where sr.space_no = s.space_no and m.member_no = s.member_no and st.cate_no = s.cate_no 
					and ${select} like '%'|| #{search} ||'%'
						order by ${column} ${sort}
	</select>
		
		
	
	<select id="listReserve" parameterType="java.util.Map" resultType="reservedRoomDTO">
		select res.res_nm, sr.room_nm, to_char(res.use_dt,'""YYYY"년 "MM"월 "DD"일"') as use_dt, to_char(res.use_time,'""HH24"시 "MM"분"') as use_time, s.space_pno, res.res_pno, 
				res.res_email, res.res_personnel,
				CASE res.res_st WHEN 0 THEN '예약확정 대기중'
								WHEN 1 THEN '예약취소'
								WHEN 2 THEN '예약완료'
								ELSE '모름'
								END AS res_st
		from reserve res, space_room sr, member m, space s
		where res.room_no = sr.room_no and s.space_no = sr.space_no and res.member_no = m.member_no
		order by ${column} ${sort}
	</select>
	<select id="searchReserve" parameterType="java.util.Map" resultType="reservedRoomDTO">
		select res.res_nm, sr.room_nm, to_char(res.use_dt,'""YYYY"년 "MM"월 "DD"일"') as use_dt, to_char(res.use_time,'""HH24"시 "MM"분"') as use_time, s.space_pno, res.res_pno, 
				res.res_email, res.res_personnel,
				CASE res.res_st WHEN 0 THEN '예약확정 대기중'
								WHEN 1 THEN '예약취소'
								WHEN 2 THEN '예약완료'
								ELSE '모름'
								END AS res_st
		from reserve res, space_room sr, member m, space s
		where res.room_no = sr.room_no and s.space_no = sr.space_no and res.member_no = m.member_no and ${select} like '%'|| #{search} ||'%'
		order by ${column} ${sort}
	</select>
	
	
	
	<!-- deleteMember 실제로는 member_grade 값을 수정 해 list에서 보이지 않게 처리 -->	
	<update id="deleteMember" parameterType="int">
		update member set member_grade = 2 where member_no = #{member_no}
	</update>
	
	<select id="ifHasBuilding" parameterType="int" resultType="int">
		select count(member_no) FROM SPACE WHERE member_no= #{member_no}
	</select>
	<select id="getMemberNm" parameterType="int" resultType="memberDTO">
		select member_nm from member where member_no =#{member_no}
	</select>
	
	<!-- deleteBuilding 건물에는 따로 grade 값을 주지 않았기 때문에  실제로 데이터를 삭제-->
	
	
	<delete id="deleteBuilding" parameterType="int">
		delete from space where space_no = #{space_no}
	</delete>
	<select id="ifHasRoom" parameterType="int" resultType="int">
		select count(space_no) from space_room where space_no = #{space_no}
	</select>
	<select id="getSpaceNm" parameterType="int" resultType="spaceDTO">
		select member_no, space_nm from space where space_no = #{space_no}
	</select>
	
	
	
	
	<!-- <select id="sortGuest" resultType="Object">
        select * from member
        <if test="pageable.sort.sorted">
            <trim prefix="order by">
                <foreach item="order" index="i" collection="pageable.sort" separator=", ">
                    ${order.property} ${order.direction}
                </foreach>
            </trim>
        </if>
        limit ${pageable.size} offset ${pageable.page}*${pageable.size}
    </select> -->
		
	<!-- 	
	<select id="listHost" resultType="memberDTO">
		select member_no, member_email, member_pw, member_nm, member_pno, member_reg_dt 
		from member where member_grade = 1
		
		
	</select> -->
	
	<!-- <select id="listSpaceRoom" resultType="spaceRoomDTO">
		select * from space_room
	</select> -->
</mapper>